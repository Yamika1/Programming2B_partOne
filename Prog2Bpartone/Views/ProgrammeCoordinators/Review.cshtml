@model Prog2Bpartone.Models.Claims

@{
    ViewBag.Title = "Review Claim";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<nav class="mb-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-item"><a href="/ProgrammeCoordinators">My Claims</a></li>
        <li class="breadcrumb-item active">Review</li>
    </ol>
</nav>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header d-flex">
                @if (Model.Status == Prog2Bpartone.Models.ClaimStatus.Pending)
                {
                    <span class="badge bg-warning fs-6">Pending Review</span>
                }
                else if (Model.Status == Prog2Bpartone.Models.ClaimStatus.Verified)
                {
                    <span class="badge bg-success fs-6">Verified</span>
                }
                else if (Model.Status == Prog2Bpartone.Models.ClaimStatus.Rejected)
                {
                    <span class="badge bg-danger fs-6">Rejected</span>
                }
            </div>

            <div class="card-body">

                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Claim Name</strong></div>
                    <div class="col-sm-9">@Model.ClaimName</div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Claim Type</strong></div>
                    <div class="col-sm-9">@Model.ClaimType</div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Hours Worked</strong></div>
                    <div class="col-sm-9">@Model.HoursWorked</div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Hourly Rate</strong></div>
                    <div class="col-sm-9">@Model.HourlyRate</div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Total Amount</strong></div>
                    <div class="col-sm-9">@Model.TotalAmount.ToString("C")</div>
                </div>

                <div class="row mb-3">
                    <div class="col-sm-3"><strong>Submitted</strong></div>
                    <div class="col-sm-9">@Model.SubmittedDate.ToString("MM/dd/yyyy")</div>
                </div>

            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">

                @if (Model.Status == Prog2Bpartone.Models.ClaimStatus.Pending)
                {
                    <h5>Review Claim</h5>

                    <form asp-controller="ProgrammeCoordinator" asp-action="Verify" method="post" class="mb-3">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@Model.ClaimId" />
                        <button type="submit" class="btn btn-success btn-lg w-100">Verify</button>
                    </form>

                    <form asp-controller="ProgrammeCoordinator" asp-action="Reject" method="post">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@Model.ClaimId" />

                        <div class="mb-3">
                            <label class="form-label">Reason for rejecting *</label>
                            <textarea name="comments" class="form-control" rows="3" required></textarea>
                        </div>

                        <button type="submit" class="btn btn-danger btn-lg w-100">Reject</button>
                        <a href="/ProgrammeCoordinators" class="btn btn-secondary w-100 mt-2">Cancel</a>
                    </form>
                }
                else
                {
                    <p class="text-muted">This claim has already been reviewed.</p>
                }

            </div>
        </div>
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">
        <h5>Supporting Documents (@Model?.Documents?.Count ?? 0)</h5>
    </div>

    <div class="card-body">
        @if (Model.Documents == null || !Model.Documents.Any())
        {
            <p class="text-muted">No documents uploaded.</p>
        }
        else
        {
            <div class="list-group">
                @foreach (var doc in Model.Documents)
                {
                    <div class="list-group-item d-flex flex-column">
                        <strong>@doc.FileName</strong>
                        <span class="badge bg-success mb-1">Encrypted</span>
                        <small>@(doc.FileSize / 1024) KB</small>

                        <a asp-controller="Lecturer"
                           asp-action="DownloadDocument"
                           asp-route-claimId="@Model.ClaimId"
                           asp-route-docId="@doc.Id"
                           class="btn btn-sm btn-primary mt-2">
                            Download & Decrypt
                        </a>
                    </div>
                }
            </div>
        }
    </div>
</div>
